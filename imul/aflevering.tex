\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[danish]{babel}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{listings}

\setlength{\parindent}{0in}
\setlength{\parskip}{0.1in}

\newcommand{\imul}{\texttt{imul}}

\newtheorem{theorem}{Sætning}

\title{Computere og Netværk (Q2/2010)}
\author{Mathias Rav, 20103940 \\
		Michael Søndergaard, 20104223 \\
		DAT-3}
\date{Uge 1, 7.\ november 2010}

\begin{document}
\maketitle

\section{Multiplikation med \texttt{imul.c}}
Kørsel af programmet \texttt{imul.c} gav:

$\text{imul}(2,3) = 6.$

Ved kørsel med en negativ værdi for $x$ fås resultatet $0$.  $x$, den første
operand til \imul, indgår nemlig i while-løkkens betingelse: \texttt{while ( x
> 0 )}. Hvis $x$ ikke er positiv, så vil løkken ikke blive udført, og
resultatet af funktionen vil være $0$, selvom $xy\ne0$.

En kørsel med $x=2$ og $y=-4$ gav:

$\text{imul}(2,-4) = -8.$

Programmet vil altid multiplicere korrekt når $x$ er positiv, da
addition/subtraktion er defineret for alle heltal, sådan som det sker i
kodelinjen \texttt{p = p + y}.  Hvis $y$ er negativ, så vil $p$ blive mindre.

Rent matematisk har funktionen \imul{} en state, der er givet ved tuplen
$(x,y,p)$. Så længe $x>0$ vil kroppen af while-løkken ændre staten af
funktionen: $x$ bliver \'en mindre, og $y$ bliver lagt til $p$. Dette
fortsætter indtil $x$ er mindre end eller lig med $0$, hvor resultatet af
funktionen er $p$. Det kan beskrives ved en funktion såsom
\[\delta(x,y,p)=\left\{\begin{array}{cc}
	\delta(x-1,y,p+y) & \text{hvis }x>0 \\
	p & \text{hvis }x\leq 0
\end{array}\right.\]

\begin{theorem}
	For $x,y,p\in\mathbb{Z},x\leq0$ er $\delta(x,y,p)=xy+p$.
\end{theorem}

\begin{proof}
	Vi beviser sætningen ved induktion på $x$.
	\paragraph{Basis $x=0$} Ved definitionen af $\delta$ gælder netop $\delta(0,y,p)=p=0\cdot y+p$.
	\paragraph{Induktion} Antag, at $\delta(x-1,y,p)=(x-1)y+p$. Så er
	\begin{align*}
		\delta(x,y,p)&=\delta(x-1,y,p+y) \\
		&=(x-1)y+p+y \\
		&=xy+p. \qedhere{}
	\end{align*}
\end{proof}

Af induktionsbeviset fremgår det, at $\delta(x,y,p)=xy+p$. Da variablen $p$ er
lokal i funktionen og initialiseret til $0$, må resultatet ved kørsel af
C-funktionen $\texttt{imul(int x, int y)}$ for positiv $x$ og vilkårlig $y$
være $\delta(x,y,0)=xy$.
\clearpage
\section{Multiplikation med \imul{}-programmet, i IJVM}
En kørsel af programmet imul.j ser således ud:

IJVM Trace of gen/imul.bc Sun Nov  7 15:08:28 2010

\begin{tabular}{llllllllll}
                    &                    & stack = 0,& 1,& 16 \\
bipush 44           &\texttt{[10 2c]    }& stack = 44,& 0,& 1,& 16 \\
bipush 2            &\texttt{[10 02]    }& stack = 2,& 44,& 0,& 1,& 16 \\
bipush 3            &\texttt{[10 03]    }& stack = 3,& 2,& 44,& 0,& 1,& 16 \\
invokevirtual 0     &\texttt{[b6 00 00] }& stack = 15,& 51,& 0,& 3,& 2,& 22,& 0,& 1 \\
bipush 0            &\texttt{[10 00]    }& stack = 0,& 15,& 51,& 0,& 3,& 2,& 22,& 0 \\
istore 3            &\texttt{[36 03]    }& stack = 15,& 51,& 0,& 3,& 2,& 22,& 0,& 1 \\
iload 1             &\texttt{[15 01]    }& stack = 2,& 15,& 51,& 0,& 3,& 2,& 22,& 0 \\
iflt 25             &\texttt{[9b 00 19] }& stack = 15,& 51,& 0,& 3,& 2,& 22,& 0,& 1 \\
iload 1             &\texttt{[15 01]    }& stack = 2,& 15,& 51,& 0,& 3,& 2,& 22,& 0 \\
ifeq 20             &\texttt{[99 00 14] }& stack = 15,& 51,& 0,& 3,& 2,& 22,& 0,& 1 \\
iload 1             &\texttt{[15 01]    }& stack = 2,& 15,& 51,& 0,& 3,& 2,& 22,& 0 \\
bipush 1            &\texttt{[10 01]    }& stack = 1,& 2,& 15,& 51,& 0,& 3,& 2,& 22 \\
isub                &\texttt{[64]       }& stack = 1,& 15,& 51,& 0,& 3,& 2,& 22,& 0 \\
istore 1            &\texttt{[36 01]    }& stack = 15,& 51,& 0,& 3,& 1,& 22,& 0,& 1 \\
iload 3             &\texttt{[15 03]    }& stack = 0,& 15,& 51,& 0,& 3,& 1,& 22,& 0 \\
iload 2             &\texttt{[15 02]    }& stack = 3,& 0,& 15,& 51,& 0,& 3,& 1,& 22 \\
iadd                &\texttt{[60]       }& stack = 3,& 15,& 51,& 0,& 3,& 1,& 22,& 0 \\
istore 3            &\texttt{[36 03]    }& stack = 15,& 51,& 3,& 3,& 1,& 22,& 0,& 1 \\
goto -24            &\texttt{[a7 ff e8] }& stack = 15,& 51,& 3,& 3,& 1,& 22,& 0,& 1 \\
iload 1             &\texttt{[15 01]    }& stack = 1,& 15,& 51,& 3,& 3,& 1,& 22,& 0 \\
iflt 25             &\texttt{[9b 00 19] }& stack = 15,& 51,& 3,& 3,& 1,& 22,& 0,& 1 \\
iload 1             &\texttt{[15 01]    }& stack = 1,& 15,& 51,& 3,& 3,& 1,& 22,& 0 \\
ifeq 20             &\texttt{[99 00 14] }& stack = 15,& 51,& 3,& 3,& 1,& 22,& 0,& 1 \\
iload 1             &\texttt{[15 01]    }& stack = 1,& 15,& 51,& 3,& 3,& 1,& 22,& 0 \\
bipush 1            &\texttt{[10 01]    }& stack = 1,& 1,& 15,& 51,& 3,& 3,& 1,& 22 \\
isub                &\texttt{[64]       }& stack = 0,& 15,& 51,& 3,& 3,& 1,& 22,& 0 \\
istore 1            &\texttt{[36 01]    }& stack = 15,& 51,& 3,& 3,& 0,& 22,& 0,& 1 \\
iload 3             &\texttt{[15 03]    }& stack = 3,& 15,& 51,& 3,& 3,& 0,& 22,& 0 \\
iload 2             &\texttt{[15 02]    }& stack = 3,& 3,& 15,& 51,& 3,& 3,& 0,& 22 \\
iadd                &\texttt{[60]       }& stack = 6,& 15,& 51,& 3,& 3,& 0,& 22,& 0 \\
istore 3            &\texttt{[36 03]    }& stack = 15,& 51,& 6,& 3,& 0,& 22,& 0,& 1 \\
\end{tabular}
\clearpage
\begin{tabular}{llllllllll}
goto -24            &\texttt{[a7 ff e8] }& stack = 15,& 51,& 6,& 3,& 0,& 22,& 0,& 1 \\
iload 1             &\texttt{[15 01]    }& stack = 0,& 15,& 51,& 6,& 3,& 0,& 22,& 0 \\
iflt 25             &\texttt{[9b 00 19] }& stack = 15,& 51,& 6,& 3,& 0,& 22,& 0,& 1 \\
iload 1             &\texttt{[15 01]    }& stack = 0,& 15,& 51,& 6,& 3,& 0,& 22,& 0 \\
ifeq 20             &\texttt{[99 00 14] }& stack = 15,& 51,& 6,& 3,& 0,& 22,& 0,& 1 \\
iload 3             &\texttt{[15 03]    }& stack = 6,& 15,& 51,& 6,& 3,& 0,& 22,& 0 \\
ireturn             &\texttt{[ac]       }& stack = 6,& 0,& 1,& 16 \\
ireturn             &\texttt{[ac]       }& stack = 6
\end{tabular}

return value: 6

Hvis vi kører programmet \imul{} med parametrene $x=-1$ og $y=5$, får vi resultatet $0$

Det fremgår af stack-tracen:

IJVM Trace of \texttt{imul.bc} Thu Nov  4 20:57:23 2010

\begin{tabular}{llllllllll}
                &                    & stack = 0,& 1,& 16 \\
bipush 44       & \texttt{[10 2c]   }& stack = 44,& 0,& 1,& 16 \\
bipush -1       & \texttt{[10 ff]   }& stack = -1,& 44,& 0,& 1,& 16 \\
bipush 5        & \texttt{[10 05]   }& stack = 5,& -1,& 44,& 0,& 1,& 16 \\
invokevirtual 0 & \texttt{[b6 00 00]}& stack = 15,& 51,& 0,& 5,& -1,& 22,& 0,& 1 \\
bipush 0        & \texttt{[10 00]   }& stack = 0,& 15,& 51,& 0,& 5,& -1,& 22,& 0 \\
istore 3        & \texttt{[36 03]   }& stack = 15,& 51,& 0,& 5,& -1,& 22,& 0,& 1 \\
iload 1         & \texttt{[15 01]   }& stack = -1,& 15,& 51,& 0,& 5,& -1,& 22,& 0 \\
iflt 25         & \texttt{[9b 00 19]}& stack = 15,& 51,& 0,& 5,& -1,& 22,& 0,& 1 \\
iload 3         & \texttt{[15 03]   }& stack = 0,& 15,& 51,& 0,& 5,& -1,& 22,& 0 \\
ireturn         & \texttt{[ac]      }& stack = 0,& 0,& 1,& 16 \\
ireturn         & \texttt{[ac]      }& stack = 0
\end{tabular}

return value: $0$


Hvis vi kører programmet med parametrene $x=2$ og $y=3$, får vi resultatet $6$

Som det kan ses fra stack-tracen i filen "imul2.trace", så er stakken størst, efter instruktionen \texttt{invokevirtual 0 [b6 00 00]}. Den har en størrelse på $8$.

Stakkens størrelse er konstant for $-128 < x < 128$ og $-128 < y < 128$, da programmet ikke kan eksekveres med værdier uden for dette domæne. Dog ville stakken skulle være større, hvis man gav x og y arbitrære værdier, som kræver at man lagrer dem i flere registre.

\subsection{Antallet af instruktioner ved kørsel af \imul{}}
Ved kørsel af \imul{} med $x=0$ og $y=0$, er anstaller af instruktioner der bliver udført $14$.

Hvis man kører programmet med en hvilken som helst anden værdi af $y$, vil antallet af instruktioner være det samme.

Hvis man dog kører med $x=1$, bliver antallet af instruktioner $17$. Ved $x=2$, bliver det $30$. Ved $x=50$ bliver det $664$.

Følgende tabel, viser antallet af instruktioner ved de givne x-værdier. Disse er fundet ved at køre et hjælpe-shellscript, som vi har skrevet: \texttt{sh repl.sh}, og skrive x ned fra 0-4 og 50. Derefter ses linjeantallet i stacktracen. Linjeantallet -3 giver antallet af instruktioner, som er blevet udført.

\begin{tabular}{|l|l|}
\hline
x  & Instruktioner \\ \hline
0  & 14  \\ \hline
1  & 27  \\ \hline
2  & 40  \\ \hline
3  & 53  \\ \hline
4  & 66  \\ \hline
50 & 664 \\ \hline

\end{tabular}

Fra tabellen, kan man se et mønster, beskrevet ved følgende afhængighed:

\[
	i = 13x + 14
\]

Dette skyldes, at for hvergang x bliver en større, skal der udføres 13 ekstra instruktioner, for at addere x og y.

For at mindske antallet af instruktioner, kan man TODO: optimér imul.

\end{document}
